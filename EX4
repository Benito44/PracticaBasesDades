Apartat 4 (3 punts). Volem tenir una taula anomenada llei_dhont a on hi hagi per cada provincia i
candidatura el número d’escons que ha tret la candidatura en aquella província.
DDL per crear la taula llei_dhont
CREATE TABLE llei_dhont (
eleccio_id TINYINT,
provincia_id TINYINT,
candidatura_id INT,
num_escons TINYINT,
CONSTRAINT pk_llei_dhont PRIMARY KEY (eleccio_id, provincia_id,
candidatura_id)
)
Per omplir aquesta taula crea un subprograma encarregat de fer aquesta feina. Aquest subprograma
ha de rebre com a paràmetres la PK de les eleccions i la PK de la província.
spCalcularLleiHontEleccionsProvincia(pEleccioId, pProvinciaId)




#ejercicio para probar

-- Crear tabla temporal para guardar los resultados
CREATE TEMPORARY TABLE tmp_escons (candidatura_id INT, esco_id INT, num_vots FLOAT);

-- Loop para dividir los votos por los escaños correspondientes
DECLARE esco INT DEFAULT 1;
WHILE esco <= num_escons DO
    INSERT INTO tmp_escons (candidatura_id, esco_id, num_vots)
    SELECT c.candidatura_id, esco, c.num_vots / esco
    FROM candidaturas c
    WHERE c.provincia_id = provincia_id AND c.eliminada = FALSE;
    SET esco = esco + 1;
END WHILE;

-- Seleccionar los resultados más altos hasta el número de escaños correspondiente
INSERT INTO lleis_dhont (eleccio_id, provincia_id, candidatura_id, num_escons_finals)
SELECT eleccio_id, provincia_id, candidatura_id, SUM(esco_id <= num_escons) as num_escons_finals
FROM tmp_escons
GROUP BY eleccio_id, provincia_id, candidatura_id
ORDER BY eleccio_id, provincia_id, num_escons_finals DESC;

-- Eliminar tabla temporal
DROP TABLE tmp_escons;

